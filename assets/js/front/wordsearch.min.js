!function(t){function s(t){const s=new Uint32Array(t.length);if(s&&s.length>0){crypto.getRandomValues(s);for(let e=t.length-1;e>0;e--){const i=s[e]%(e+1);[t[e],t[i]]=[t[i],t[e]]}}return t}function e(t){const s=new Uint32Array(1);return crypto.getRandomValues(s),s[0]%t}function i(s,e){this.x=s,this.y=e,this.letter=null,this.$=t("<div></div>"),this.$.addClass("cmsws-cell"),this.$.data("x",this.x),this.$.data("y",this.y)}function n(t=[],e="",n=[],r=10,l=10){this.width=r,this.height=r,this.directions=s(n),e=s(e),this.cells=Array.from({length:this.height},((t,s)=>Array.from({length:this.width},((t,e)=>new i(e,s))))),this.used_words=[],t=s(t);for(const s of t){const t=s.replace(/[\s-']/g,"");for(let s=0;s<10;s++)if(!this.used_words.includes(t)&&this._tryPlaceWord(t)){this.used_words.push(t);break}if(this.used_words.length>=l)break}this.cells.forEach((t=>t.forEach((t=>t.randomFill(e))))),this.used_words.sort(((t,s)=>s.length-t.length))}function r(s){this.$ws_container=t("#cmsws_container_"+s),this.allowed_chars=t("#cmsws_allowed_chars_"+s).val().trim(),this.field_size=t("#cmsws_field_size_"+s).val().trim(),this.letterGrid=null,this.firstClickedCell=null,this.found_words=0,this.words=t("#cmsws_custom_words_"+s).val().split(cmsws_front_args.word_separator),this.words=this.words.filter((t=>""!==t&&t.length<=this.field_size));const e=t("#cmsws_directions_"+s).val().split(cmsws_front_args.word_separator);this.directions=e.map((t=>({east:{x:1,y:0},south:{x:0,y:1},west:{x:-1,y:0},north:{x:0,y:-1},southeast:{x:1,y:1},northeast:{x:1,y:-1},southwest:{x:-1,y:1},northwest:{x:-1,y:-1}}[t]))),this.$ws_container.find("#btn-new-game").on("click",function(){this.$ws_container.find("#cmws-modal").css("display","none"),this.newGame()}.bind(this)),this.$ws_container.find("#cmsws-closemodale").on("click",function(){this.$ws_container.find("#cmws-modal").css("display","none")}.bind(this))}i.prototype.willFitLetter=function(t){return null===this.letter||this.letter===t},i.prototype.randomFill=function(t){if(null==this.letter){const s=e(t.length);return this.letter=t[s]}},i.prototype.toHtml=function(){return this.$.text(this.letter||""),this.$},n.prototype._tryPlaceWord=function(t){const s=this.directions[e(this.directions.length)];if(0!==s.x&&t.length>this.width||0!==s.y&&t.length>this.height)return!1;const i=(t,s,i)=>{const n=e(i-s+1);return-1===t?i-n:n},n={x:i(s.x,t.length,this.width),y:i(s.y,t.length,this.height)},r={x:n.x+s.x*(t.length-1),y:n.y+s.y*(t.length-1)},l=this.getPath(n,r);return null!==l&&(!!l.every(((s,e)=>s.willFitLetter(t[e])))&&(l.every(((s,e)=>s.letter=t[e])),!0))},n.prototype.getPath=function(t,s){const e=[],i={x:s.x-t.x,y:s.y-t.y},n=0===i.x?0:i.x/Math.abs(i.x),r=0===i.y?0:i.y/Math.abs(i.y),l={x:t.x,y:t.y};for(;l.x>=0&&l.y>=0&&l.x<this.width&&l.y<this.height;){if(e.push(this.cells[l.y][l.x]),l.x===s.x&&l.y===s.y)return e;l.x+=n,l.y+=r}return null},n.prototype.isPathAllowed=function(t,s){const e=Math.abs(s.x-t.x),i=Math.abs(s.y-t.y);return e===i||0===e||0===i},n.prototype.isPathAWord=function(s,e){const i=s.map((t=>t.letter)).join("");return!!this.used_words.includes(i)&&(s.forEach((t=>{t.$.addClass("cmsws-is-word"),t.$.addClass("cmsws-color"+e)})),t("#cmsws-"+i).addClass("found"),!0)},n.prototype.getHtmlTable=function(){const s=t('<div class="cmsws-table"></div>');return this.cells.forEach((e=>{const i=t('<div class="cmsws-row"></div>');e.forEach((t=>i.append(t.toHtml()))),s.append(i)})),s},n.prototype.getUsedWordsList=function(){const s=t('<div id="usedWords" class="used-word-list"></div>');return this.used_words.forEach((e=>{const i=t("<div></div>");i.addClass("word-box"),i.text(e),i.attr("id","cmsws-"+e),s.append(i)})),s},r.prototype.reSize=function(){const t=.95*this.$ws_container.width(),s=Math.min(t/this.field_size,50);this.$ws_container.find(".cmsws-cell").css({width:s+"px",height:s+"px"})},r.prototype.newGame=function(){this.letterGrid=null,this.firstClickedCell=null,this.found_words=0,this.$ws_container.find("#letterGridContainer").remove(),this.$ws_container.find("#UsedWordsContainer").remove(),this.letterGrid=new n(this.words,this.allowed_chars,this.directions,this.field_size);const s=t('<div id="letterGridContainer"></div>'),e=t('<div id="UsedWordsContainer"></div');s.append(this.letterGrid.getHtmlTable()),e.append(this.letterGrid.getUsedWordsList()),this.$ws_container.append(s,e),this.reSize(),s.on("click",".cmsws-cell",this._onClickCell.bind(this)),s.on("mouseenter",".cmsws-cell",this._togglePath.bind(this)),s.on("mouseleave",".cmsws-cell",this._togglePath.bind(this))},r.prototype._fetchCell=function(s){const e=t(s);return this.letterGrid.cells[e.data("y")][e.data("x")]},r.prototype._onClickCell=function(t){const s=this._fetchCell(t.currentTarget);if(this.firstClickedCell){if(this.firstClickedCell===s)this.firstClickedCell=null,s.$.removeClass("cmsws-clicked");else if(this.letterGrid.isPathAllowed(this.firstClickedCell,s)){const t=this.letterGrid.getPath(this.firstClickedCell,s);this.letterGrid.isPathAWord(t,this.found_words%4+1)&&this.found_words++,this.found_words>=this.letterGrid.used_words.length&&this.$ws_container.find("#cmws-modal").css("display","block"),t.forEach((t=>t.$.removeClass("cmsws-on-path"))),this.firstClickedCell.$.removeClass("cmsws-clicked"),this.firstClickedCell=null}}else this.firstClickedCell=s,s.$.addClass("cmsws-clicked")},r.prototype._togglePath=function(t){if(null===this.firstClickedCell)return;const s=this._fetchCell(t.currentTarget);if(s!==this.firstClickedCell&&this.letterGrid.isPathAllowed(this.firstClickedCell,s)){this.letterGrid.getPath(this.firstClickedCell,s).forEach((t=>t.$.toggleClass("cmsws-on-path")))}},t(document).ready((function(){let s,e=[];t(".cmsws_container").each((function(t,s){new r(s.id.replace("cmsws_container_","")).newGame()})),t(window).on("resize",(function(){clearTimeout(s),s=setTimeout((()=>{e.forEach((t=>t.reSize()))}),150)})),window.addEventListener("keydown",(function(t){(114===t.keyCode||t.ctrlKey&&70===t.keyCode)&&t.preventDefault()}))}))}(jQuery);